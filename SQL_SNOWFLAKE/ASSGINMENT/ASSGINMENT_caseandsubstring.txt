use demodatabase;

CREATE OR REPLACE TABLE RQ_ASSGNMNT_SALES
(
    ORDER_ID VARCHAR(40),
    ORDER_DATE date,
    SHIP_DATE date,
    SHIP_MODE CHAR(50),
    CUSTOMER_NAME VARCHAR(60),
    SEGMENT VARCHAR(40),
    STATE VARCHAR(40),
    COUNTRY VARCHAR(40),
    MARKET VARCHAR(50),
    REGION VARCHAR(40),
    PRODUCT_ID VARCHAR(40),
    CATEGORY VARCHAR(40),
    SUB_CATEGORY VARCHAR(80),
    PRODUCT_NAME VARCHAR(200),
    SALES VARCHAR(80),
    QUANTITY NUMBER,
    DISCOUNT float,
    PROFIT VARCHAR(30),
    SHIPPING_COST NUMBER(10,2),
    ORDER_PRIORITY CHAR(40),
    YEAR NUMBER(15)
);

DESCRIBE TABLE RQ_ASSGNMNT_SALES;
SELECT * FROM RQ_ASSGNMNT_SALES;

---1 .SET PRIMARY KEY.

ALTER TABLE RQ_ASSGNMNT_SALES
ADD PRIMARY KEY (ORDER_ID);

----2. CHECK THE ORDER DATE AND SHIP DATE TYPE AND THINK IN WHICH DATA TYPE YOU HAVE TO CHANGE.

--CONVERTED THE DATE FORMAT IN EXCEL ONLY AND THEN LOADED THE TABLE
 SELECT DISTINCT ORDER_ID, ORDER_DATE, sHIP_DATE FROM RQ_ASSGNMNT_SALES;
 
 
--3. EXTACT THE LAST NUMBER AFTER THE - AND CREATE OTHER COLUMN AND UPDATE IT.

ALTER TABLE RQ_ASSGNMNT_SALES
ADD COLUMN ID_NUMNBER VARCHAR(50);

SELECT ORDER_ID AS ORG_VALUE,SUBSTR(ORG_VALUE, 9) AS ID_NUMBER FROM RQ_ASSGNMNT_SALES;

-----4.  FLAG ,IF DISCOUNT IS GREATER THEN 0 THEN  YES ELSE FALSE AND PUT IT IN NEW COLUMN FRO EVERY ORDER ID.

SELECT ORDER_ID, ORDER_DATE, CUSTOMER_NAME, PRODUCT_NAME, SHIPPING_COST,

CASE

        WHEN DISCOUNT>0 THEN 'YES'
        ELSE 'FALSE'
        END AS DISCOUNT_AVAILABLE
FROM RQ_ASSGNMNT_SALES;
  

-----5.  FIND OUT THE FINAL PROFIT AND PUT IT IN COLUMN FOR EVERY ORDER ID.

SELECT *,
   case 
        when profit > '0' then 'profit'
        when profit < '0' then 'loss'
        else 'NO PROFIT/LOSS'
        END AS SALES_STATUS
   FROM RQ_ASSGNMNT_SALES;

---6.  FIND OUT HOW MUCH DAYS TAKEN FOR EACH ORDER TO PROCESS FOR THE SHIPMENT FOR EVERY ORDER ID
 SELECT DISTINCT ORDER_ID, ORDER_DATE, sHIP_DATE FROM RQ_ASSGNMNT_SALES;
   SELECT DATEDIFF(DAY,ORDER_DATE,SHIP_DATE) FROM RQ_ASSGNMNT_SALES;
   

--7. . FLAG THE PROCESS DAY AS BY RATING IF IT TAKES 
---LESS OR EQUAL 3  DAYS MAKE 5,
---LESS OR EQUAL THAN 6 DAYS BUT MORE THAN 3 MAKE 4,
---LESS THAN 10 BUT MORE THAN 6 MAKE 3,
--MORE THAN 10 MAKE IT 2 FOR EVERY ORDER ID.

ALTER TABLE RQ_ASSGNMNT_SALES
DROP COLUMN PROCESS_DAY;

SELECT *,

CASE

        WHEN DATEDIFF(DAY,ORDER_dATE,SHIP_DATE) <= '3' THEN '5'
        WHEN DATEDIFF(DAY,ORDER_DATE,SHIP_DATE) <= '6' AND DATEDIFF(DAY,ORDER_DATE,SHIP_DATE) > '3' THEN '4'
        WHEN DATEDIFF(DAY,ORDER_DATE,SHIP_DATE) < '10' AND DATEDIFF(DAY,ORDER_DATE,SHIP_DATE) > '6' THEN '3'  
        WHEN DATEDIFF(DAY,ORDER_DATE,SHIP_DATE) > '10' THEN '2'
        ELSE NULL
        END AS PROCESS_DAY
FROM RQ_ASSGNMNT_SALES;